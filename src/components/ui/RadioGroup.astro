---
interface Option {
  value: string;
  label: string;
}

interface Props {
  label: string;
  name: string;
  options: Option[];
  required?: boolean;
  hasOther?: boolean;
  inline?: boolean;
}

const { label, name, options, required = false, hasOther = false, inline = true } = Astro.props;
---

<fieldset>
  <legend class="mb-2 block text-sm font-medium text-gray-700">
    {label}
    {required && <span class="text-red-500">*</span>}
  </legend>
  <div class:list={[
    inline ? 'flex flex-wrap gap-x-5 gap-y-2' : 'flex flex-col gap-2',
  ]}>
    {
      options.map((option) => (
        <label class="flex items-center gap-2 text-sm text-gray-700 cursor-pointer">
          <input
            type="radio"
            name={name}
            value={option.value}
            required={required}
            class="h-4 w-4 border-gray-300 text-primary-600 focus:ring-primary-500"
          />
          {option.label}
        </label>
      ))
    }
    {
      hasOther && (
        <label class="flex items-center gap-2 text-sm text-gray-700 cursor-pointer">
          <input
            type="radio"
            name={name}
            value="other"
            class="h-4 w-4 border-gray-300 text-primary-600 focus:ring-primary-500"
            data-radio-other-toggle={name}
          />
          Others:
          <input
            type="text"
            name={`${name}_other`}
            placeholder="Please specify"
            disabled
            data-radio-other-input={name}
            class="w-40 rounded-md border border-gray-300 px-2 py-1 text-sm shadow-sm transition-colors placeholder:text-gray-400 focus:border-primary-500 focus:outline-none focus:ring-1 focus:ring-primary-500 disabled:cursor-not-allowed disabled:bg-gray-50"
          />
        </label>
      )
    }
  </div>
</fieldset>

<script>
  document.querySelectorAll<HTMLInputElement>('[data-radio-other-toggle]').forEach((otherRadio) => {
    const name = otherRadio.dataset.radioOtherToggle!;
    const input = document.querySelector<HTMLInputElement>(`[data-radio-other-input="${name}"]`);
    if (!input) return;

    const allRadios = document.querySelectorAll<HTMLInputElement>(`input[type="radio"][name="${name}"]`);
    allRadios.forEach((radio) => {
      radio.addEventListener('change', () => {
        input.disabled = !otherRadio.checked;
        if (!otherRadio.checked) input.value = '';
        if (otherRadio.checked) input.focus();
      });
    });
  });
</script>
